<html>
  <body>
    <video id="srcVideo"></video>
  </body>
  <script src="js/webrtc/wrtc.js"></script>
  <script src="js/peer.js"></script>


  <script>
var constraints = window.constraints = {
  audio: true,
  video: true
};

navigator.mediaDevices.getUserMedia(constraints).
then(successCallback).catch(errorCallback);

function successCallback(stream) {
  var video = document.querySelector('video#srcVideo');
  var videoTracks = stream.getVideoTracks();
  console.log('Got stream with constraints:', constraints);
  console.log('Using video device: ' + videoTracks[0].label);
  video.srcObject = stream;
  var audioCtx = new AudioContext();
  var source = audioCtx.createMediaStreamSource(stream);

  window.recorder = new MediaRecorder(stream, {
    mimeType: 'video/webm'
  });
  window.recorder.ondataavailable = videoDataHandler;
  window.recorder.start(1000)
    function videoDataHandler (event) {
      console.log("data ready");
      var blob = event.data;
      var reader = new FileReader()
      reader.readAsArrayBuffer(event.data);
      reader.onloadend = function (event) {
       appChannel.sendBlob(reader.result);
      };
    };

  console.debug(source);
}

function errorCallback(error) {
  console.log(error);
}

  </script>
</html>
